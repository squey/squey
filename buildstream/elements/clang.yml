description: |

  The Clang project provides a language front-end and tooling infrastructure for languages in the C language family (C, C++, Objective C/C++, OpenCL, CUDA, and RenderScript) for the LLVM project.

variables:
  (?):
    - (target_triple != "x86_64-w64-mingw32"):
        archive_url: "github:llvm/llvm-project/archive/refs/tags/llvmorg-21.1.1.tar.gz"
        archive_ref: "5f048351ee63050d7fa45b6a1160768fb222a8d306a89e1344515ef7a4bcd278"
        patch: "buildstream/patches/noop.patch"
    - (target_triple == "x86_64-w64-mingw32"):
        archive_url: "github:llvm/llvm-project/archive/refs/tags/llvmorg-19.1.7.tar.gz"
        archive_ref: "59abea1c22e64933fad4de1671a61cdb934098793c7a31b333ff58dc41bff36c"
        patch: "buildstream/patches/clang/fix_compilation_with_glibc_2.42.patch"
  debug_flags: "-g1"
  optimize-debug: "false"
  cmake-local: >-
    -DLLVM_ENABLE_PROJECTS='clang;compiler-rt'
    -DLLVM_ENABLE_ASSERTIONS:BOOL=OFF
    -DBUILD_SHARED_LIBS:BOOL=OFF
    -DLLVM_BUILD_LLVM_DYLIB:BOOL=ON
    -DLLVM_LINK_LLVM_DYLIB:BOOL=ON
    -DCMAKE_BUILD_TYPE=Release
    -DCMAKE_INSTALL_RPATH="%{prefix}/lib"
    -DLLVM_ENABLE_LIBCXX:BOOL=OFF
    -DLLVM_ENABLE_ZLIB:BOOL=ON
    -DLLVM_ENABLE_FFI:BOOL=ON
    -DLLVM_ENABLE_RTTI:BOOL=ON
    -DLLVM_INCLUDE_TESTS:BOOL=OFF
    -DLLVM_INCLUDE_EXAMPLES:BOOL=OFF
    -DLLVM_INCLUDE_UTILS:BOOL=ON
    -DLLVM_INSTALL_UTILS:BOOL=ON
    -DLLVM_INCLUDE_DOCS:BOOL=OFF
    -DLLVM_ENABLE_DOXYGEN:BOOL=OFF
    -DLLVM_BINUTILS_INCDIR=%{includedir}
    -DCLANG_LINK_CLANG_DYLIB=ON
    -DLLVM_INSTALL_TOOLCHAIN_ONLY:BOOL=OFF
    -DLLVM_TARGETS_TO_BUILD="X86;AArch64;AMDGPU;NVPTX"
    %{cmake-local-extra}
  cmake: |
    cmake -B%{build-dir} -Hllvm -G"%{generator}" %{cmake-args}

sources:
  - kind: tar
    url: "%{archive_url}"
    ref: "%{archive_ref}"
  - kind: patch
    path: "%{patch}"
    strip-level: 1

build-depends:
  - freedesktop-sdk.bst:components/python3.bst
  - freedesktop-sdk.bst:components/llvm.bst

depends:
  - freedesktop-sdk.bst:components/libffi.bst
